<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>enchant</title>
    <meta http-equiv="Content-Security-Policy" content="default-src * data:; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
    <script src="components/loader.js"></script>
    <script type="text/javascript" src="components/enchant.js"></script>
    <script type="text/javascript" src="components/gu.js"></script>
    <link rel="stylesheet" href="components/loader.css">
    <link rel="stylesheet" href="css/style.css">
    <style type="text/css">
        body{margin: 0;}
    </style>
    <script>
        enchant();
		
		//■■■■■■■■■■■■■■■■■■■■
		//オブジェクト定義
		//■■■■■■■■■■■■■■■■■■■■
		var Gu = Class.create(Sprite,{	//クラスを作るメソッド。第一引数に継承元のクラスを。変数に収めることでオーバーライドした新しいクラスを作成できる。
			initialize: function(x,y,p){	//位置と、パターンを渡せるように引数設定。initializeはコンストラクタなんですって。最初に実行される初期化関数。対義語はディスコンストラクタですって。意味は知らないけど。
				Sprite.call(this, 56, 276);	//第一引数はコンテキスト…スコープ、以降は必要な引数。最初にcallすることで事実上継承してるみたい。
				this.x = x;
				this.y = y;
				this.image = core.assets['img/burger.png'];
				stage.addChild(this);	//グループに追加。グループは複数の子ノードを持てるらしい。
			},
			onenterframe: function(){
				this.y += 1;
				this.x += Math.sin( this.age*0.1);
			}

		});

		
        window.onload = function() {
            
            //■■■■■■■■■■■■■■■■■■■■
            //Coreシーン
            //■■■■■■■■■■■■■■■■■■■■
            core = new Core(768, 1024);
            core.fps = 25;
            core.preload('01_migitt.png','02_hidarite.png','haikei.png','img/burger.png','kao.png','damage3.mp3','swing1.mp3','famipop4.mp3','main.png');
            core.onload = function() {
				stage = new Group();	//新しいグループを作成。インスタンスたちの受け皿になる予定。
				core.rootScene.addChild( stage );	//↑を、シーンに追加

				//core.assets['famipop4.mp3'].play();
				//core.assets['famipop4.mp3'].src.loop = true;

                                
                var haikei = new Sprite(768, 1024);
                haikei.image = core.assets['haikei.png'];
                haikei.x = 0;
                haikei.y = 0;
                haikei.scale(1, 1);
                core.rootScene.addChild(haikei);
                
                var hidarite = new Sprite(306, 996);
                hidarite.image = core.assets['02_hidarite.png'];
                hidarite.x = 470;
                hidarite.y = 463;
                hidarite.scale(0.5, 0.5);
                core.rootScene.addChild(hidarite);
                
                var migitt = new Sprite(306, 996);
                migitt.image = core.assets['01_migitt.png'];
                migitt.x = - 50;
                migitt.y = 463;
                migitt.scale(0.5, 0.5);
                core.rootScene.addChild(migitt);
                
                var kao = new Sprite(752, 283);
                kao.image = core.assets['kao.png'];
                kao.x = 0;
                kao.y = 880;
                kao.scale(1, 1);
                kao.gu_flg = 1;
                core.rootScene.addChild(kao);
				
                core.tick = 0;
                
                /*----------------------------------
                UI
                ----------------------------------*/
                var infoLabel = new Label(kao.gu_flg);
                infoLabel.x = 0;
                infoLabel.y = 0;
                infoLabel.font = '100px sens-serif';
                core.rootScene.addChild(infoLabel);
                
                /*----------------------------------
                具
                ----------------------------------*/
				/*
				var burger = new Sprite(56, 276);
                burger.fps = 5;
                burger.frame = Math.floor(Math.random()*5+1);
                burger.image = core.assets['img/burger.png'];
                burger.x = Math.random()*(768-burger.width);
                burger.y = 0;
                burger.scale(0.8, 0.8);
                core.rootScene.addChild(burger);
                */
                
                /*----------------------------------
                以下、イベントリスナー系
                ----------------------------------*/
				core.addEventListener( 'enterframe', function(){	//毎フレーム実行
					if ( core.frame%10 == 0){	//10回に１回実行。密度を1/10に減らす。
						var gu = new Gu( Math.random()*320, 0);
					}
					infoLabel.text = core.tick;
                    core.tick += 1;
				});
				
				kao.addEventListener('touchstart',function(e) {
                        core.assets['swing1.mp3'].play();
                })

                kao.addEventListener('touchmove',function(e) {
                        this.x = e.x - this.width /2;
                        hidarite.x =  this.x + 100 + this.width /2;
                        migitt.x =  this.x + 290 - this.width /2;
                })
                
                kao.addEventListener('touchend',function(e) {
                        hidarite.x =  this.x - 90 + this.width /2;
                        migitt.x =  this.x  - 210 + this.width /2;
                        core.assets['damage3.mp3'].play();
                })
                                               
        
            }
            core.start();
            
        }
    </script>
</head>
<body>
    <br>
    This is a template for Monaca app.<br>
</body>
</html>
